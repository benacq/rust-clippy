#![allow(clippy::collapsible_if)]
#![warn(clippy::manual_checked_sub)]

fn positive_tests() {
    let a: u32 = 10;
    let b: u32 = 5;
    let c: u32 = 3;

    if let Some(difference_1) = a.checked_sub(b) {
        //~^ manual_checked_sub
        let difference = "some test";
        let d = difference_1;
    }

    if let Some(difference) = a.checked_sub(b) {
        //~^ manual_checked_sub
        let d = difference;
    }

    if let Some(difference) = a.checked_sub(b) {
        //~^ manual_checked_sub
        let d = difference;
    } else {
        let d = a + b;
    }

    if let Some(difference) = a.checked_sub(b) {
        //~^ manual_checked_sub
        let d = difference;
    } else if a < b {
        let d = a + b;
    }

    if let Some(decremented) = a.checked_sub(1) {
        //~^ manual_checked_sub
        let _ = decremented;
    }

    if let Some(decremented) = a.checked_sub(1) {
        //~^ manual_checked_sub
        let _ = decremented;
    }

    let mut difference = "variable initialized outside the if scope";
    if let Some(difference_1) = a.checked_sub(b) {
        //~^ manual_checked_sub
        let some_reference = difference;
        let d = difference_1;
    }

    if let Some(decremented_1) = a.checked_sub(b) {
        //~^ manual_checked_sub
        let decremented = "variable initialized inside the if scope";
        let d = decremented_1;
    }

    if let Some(difference) = a.checked_sub(b) {
        //~^ manual_checked_sub
        some_function(difference);
    }

    if let Some(difference) = a.checked_sub(b) {
        //~^ manual_checked_sub
        macro_rules! subtract {
            () => {
                difference
            };
        }
        let _ = subtract!();
    }

    struct Example {
        value: u32,
    }

    if let Some(difference) = a.checked_sub(b) {
        //~^ manual_checked_sub
        let _ = Example { value: difference };
    }

    if let Some(difference) = a.checked_sub(b) {
        //~^ manual_checked_sub
        if c > 0 {
            let _ = difference;
        }
    }

    if a >= b {
        if let Some(decremented) = c.checked_sub(1) {
            //~^ manual_checked_sub
            let _ = decremented;
        }
    }
}

fn some_function(a: u32) {}

fn negative_tests() {
    let a: u32 = 10;
    let b: u32 = 5;

    let x: i32 = 10;
    let y: i32 = 5;

    let mut a_mut = 10;

    if a_mut >= b {
        a_mut *= 2;
        let c = a_mut - b;
    }

    if a_mut > 0 {
        a_mut *= 2;
        let c = a_mut - 1;
    }

    if x >= y {
        let _ = x - y;
    }

    if a == b {
        let _ = a - b;
    }

    if a > b {
        let _ = a - b;
    }

    if 10 >= 5 {
        let _ = 10 - 5;
    }
}

fn main() {
    positive_tests();
    negative_tests();
}
