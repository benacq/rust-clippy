#![allow(clippy::collapsible_if)]
#![warn(clippy::manual_checked_sub)]

fn positive_tests() {
    let a: u32 = 10;
    let b: u32 = 5;
    let c = 3;

    // Basic subtraction inside an if
    if let Some(result) = a.checked_sub(b)  {
        //~^ manual_checked_sub
        let c = result;
    }

    // Basic subtraction inside an if with an else block
    if let Some(result) = a.checked_sub(b)  {
        //~^ manual_checked_sub
        let c = result;
    } else {
        let c = a + b;
    }

    // Decrementing inside an if condition
    if let Some(result) = a.checked_sub(0)  {
        //~^ manual_checked_sub
        let _ = result;
    }

    // Variable subtraction used in a function call
    if let Some(result) = a.checked_sub(b)  {
        //~^ manual_checked_sub
        some_function(result);
    }

    // Subtracting two suffixed literals
    if let Some(result) = 10u32.checked_sub(5u32)  {
        //~^ manual_checked_sub
        let _ = result;
    }

    let x: i32 = 10;
    let y: i32 = 5;

    // Casted variables inside an if
    if let Some(result) = (x as u32).checked_sub(y as u32) {
        //~^ manual_checked_sub
        let _ = result;
    }

    // Casted variable and literal inside an if
    if let Some(result) = (x as u32).checked_sub(5u32) {
        //~^ manual_checked_sub
        let _ = result;
    }

    // Casting subtraction result
    if let Some(result) = a.checked_sub(b)  {
        //~^ manual_checked_sub
        let _ = result as u64;
    }

    if let Some(result) = a.checked_sub(b)  {
        //~^ manual_checked_sub
        macro_rules! subtract {
            () => {
                result
            };
        }
        let _ = subtract!();
    }

    struct Example {
        value: u32,
    }

    if let Some(result) = a.checked_sub(b)  {
        //~^ manual_checked_sub
        let _ = Example { value: result };
    }

    // Subtraction inside a nested if, should lint
    if let Some(result) = a.checked_sub(b)  {
        //~^ manual_checked_sub
        if c > 0 {
            let _ = result;
        }
    }
}

fn some_function(a: u32) {}

fn negative_tests() {
    let a: u32 = 10;
    let b: u32 = 5;

    // Uses `.checked_sub()`, should not trigger
    let _ = a.checked_sub(b);

    // Works with signed integers (i32), should not trigger
    let x: i32 = 10;
    let y: i32 = 5;

    if x >= y {
        let _ = x - y;
    }

    // If condition does not match subtraction variables
    if a == b {
        let _ = a - b;
    }

    // a - b inside an if a > b (shouldn't lint)
    if a > b {
        let _ = a - b;
    }

    // Unsuffixed literals (shouldn't lint)
    if 10 >= 5 {
        let _ = 10 - 5;
    }

    // Suffixed LHS, unsuffixed RHS (shouldn't lint)
    if 10u32 >= 5 {
        let _ = 10u32 - 5;
    }

    //  Unsuffixed LHS, suffixed RHS (shouldn't lint)
    if 10 >= 5u32 {
        let _ = 10 - 5u32;
    }

    // Using `.wrapping_sub()`, should not trigger
    if a >= b {
        let _ = a.wrapping_sub(b);
    }
}

fn main() {
    positive_tests();
    negative_tests();
}
